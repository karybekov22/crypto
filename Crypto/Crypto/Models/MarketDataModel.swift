//
//  MarketDataModel.swift
//  Crypto
//
//  Created by Nursultan Karybekov on 26/9/21.
//

import Foundation

// JSON data:
/*
 
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 {
   "data": {
     "active_cryptocurrencies": 9389,
     "upcoming_icos": 0,
     "ongoing_icos": 50,
     "ended_icos": 3375,
     "markets": 644,
     "total_market_cap": {
       "btc": 46097690.31002264,
       "eth": 664492232.6732262,
       "ltc": 13184370351.216291,
       "bch": 3887669329.86098,
       "bnb": 5777838431.9727125,
       "eos": 509229574170.9393,
       "xrp": 2113051828429.7856,
       "xlm": 7189899705270.352,
       "link": 80045124876.10342,
       "dot": 68139613855.11612,
       "yfi": 65285498.57683044,
       "usd": 1997001593547.0823,
       "aed": 7334986853098.448,
       "ars": 196785641370010.53,
       "aud": 2750130804521.4927,
       "bdt": 170195593109953.6,
       "bhd": 752418278407.1097,
       "bmd": 1997001593547.0823,
       "brl": 10654203201733.021,
       "cad": 2526606416155.767,
       "chf": 1844244950651.8826,
       "clp": 1583282773411931.8,
       "cny": 12914010204990.924,
       "czk": 43354105795269.734,
       "dkk": 12670266175490.537,
       "eur": 1703911654670.1436,
       "gbp": 1459262983447.8774,
       "hkd": 15548115216927.336,
       "huf": 608096970243055.6,
       "idr": 28524671511828116,
       "ils": 6388128517534.003,
       "inr": 147404878324650,
       "jpy": 221158939978168.4,
       "krw": 2356981100799880.5,
       "kwd": 600861833469.6344,
       "lkr": 398856810761713.5,
       "mmk": 3736972251275226,
       "mxn": 40049267858108.664,
       "myr": 8364441174571.948,
       "ngn": 821766155744625.6,
       "nok": 17046024175213.52,
       "nzd": 2841952937792.789,
       "php": 101212374254424.27,
       "pkr": 337692969468811.56,
       "pln": 7847187806819.372,
       "rub": 144809774753835.75,
       "sar": 7490782932418.999,
       "sek": 17276460186094.52,
       "sgd": 2702692031666.7793,
       "thb": 66742223607282.64,
       "try": 17738366654681.95,
       "twd": 55399220606908.19,
       "uah": 53374245015039.03,
       "vef": 199959769561.86914,
       "vnd": 45515473584500090,
       "zar": 29790343163795.973,
       "xdr": 1407243088937.5686,
       "xag": 89032781355.47607,
       "xau": 1140747220.281899,
       "bits": 46097690310022.64,
       "sats": 4609769031002264
     },
     "total_volume": {
       "btc": 3185233.6064194716,
       "eth": 45914729.70729903,
       "ltc": 911006587.0923674,
       "bch": 268628100.81890583,
       "bnb": 399233996.8056944,
       "eos": 35186473381.276794,
       "xrp": 146006527675.36368,
       "xlm": 496803853164.706,
       "link": 5530915325.056395,
       "dot": 4708274677.540024,
       "yfi": 4511062.543052361,
       "usd": 137987750472.09695,
       "aed": 506829007484.0131,
       "ars": 13597389238746.43,
       "aud": 190027070807.6388,
       "bdt": 11760084273038.979,
       "bhd": 51990196696.37394,
       "bmd": 137987750472.09695,
       "brl": 736178447543.6832,
       "cad": 174582101897.29697,
       "chf": 127432653475.23463,
       "clp": 109400828206792.52,
       "cny": 892325385977.9098,
       "czk": 2995658867649.0356,
       "dkk": 875483291094.0382,
       "eur": 117735978274.05954,
       "gbp": 100831374939.22389,
       "hkd": 1074335368483.1201,
       "huf": 42017959957505.98,
       "idr": 1970982530805813.2,
       "ils": 441403495475.17084,
       "inr": 10185303624371.928,
       "jpy": 15281522419907.611,
       "krw": 162861422372197.22,
       "kwd": 41518030337.545555,
       "lkr": 27559995072275.402,
       "mmk": 258215314497674.1,
       "mxn": 2767302939392.762,
       "myr": 577961692852.3776,
       "ngn": 56781959319267.98,
       "nok": 1177837082369.4788,
       "nzd": 196371747574.34595,
       "php": 6993518627344.407,
       "pkr": 23333728604831.586,
       "pln": 542220795663.84894,
       "rub": 10005988542633.451,
       "sar": 517594121837.09204,
       "sek": 1193759626884.205,
       "sgd": 186749171795.17398,
       "thb": 4611718551869.791,
       "try": 1225676193568.4004,
       "twd": 3827945783396.5264,
       "uah": 3688025100515.84,
       "vef": 13816713454.771051,
       "vnd": 3145003905801462,
       "zar": 2058437235226.5234,
       "xdr": 97236932027.17618,
       "xag": 6151939616.480106,
       "xau": 78822742.70217587,
       "bits": 3185233606419.4717,
       "sats": 318523360641947.1
     },
     "market_cap_percentage": {
       "btc": 40.84102234490185,
       "eth": 17.666040645426325,
       "ada": 3.631347058687965,
       "usdt": 3.481356499640895,
       "bnb": 2.672702143319592,
       "xrp": 2.2107459171636537,
       "sol": 2.027158193611786,
       "usdc": 1.553922682394993,
       "dot": 1.5220494910855447,
       "doge": 1.35556546532544
     },
     "market_cap_change_percentage_24h_usd": 0.9732695199452196,
     "updated_at": 1632664883
   }
 }
 
 */

struct GlobalData: Codable {
    let data: MarketData?
}

struct MarketData: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
     
    var marketCap: String {
        if let item = totalMarketCap.first(where: {$0.key == "usd"}) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
        
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd"}) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc"}) {
            return "$" + item.value.asPercentString()
        }
        return ""
    }
}
